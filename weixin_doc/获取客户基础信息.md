获取客户基础信息

**请求方式**: POST(**HTTPS**)

**请求地址**: https://qyapi.weixin.qq.com/cgi-bin/kf/customer/batchget?access_token=ACCESS_TOKEN

**请求示例**:

```json
{
	"external_userid_list": [
		"wmxxxxxxxxxxxxxxxxxxxxxx",
		"zhangsan"
	],
	"need_enter_session_context": 0
}
```

**参数说明：**

| 参数                       | 是否必须 | 说明                                                         |
| -------------------------- | -------- | ------------------------------------------------------------ |
| access_token               | 是       | 调用接口凭证                                                 |
| external_userid_list       | 是       | external_userid列表                                          |
| need_enter_session_context | 否       | 是否需要返回客户48小时内最后一次进入会话的上下文信息。 0-不返回 1-返回。默认不返回 |

**权限说明**:
仅允许微信客服的Secret所获取的access_token调用。

![img](data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHJ4PSI4IiBmaWxsPSIjQjM2NzFEIi8+PHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik04IDNDNy40NDc3MiAzIDcgMy40NDc3MiA3IDRWOEM3IDguNTUyMjggNy40NDc3MiA5IDggOUM4LjU1MjI4IDkgOSA4LjU1MjI4IDkgOFY0QzkgMy40NDc3MiA4LjU1MjI4IDMgOCAzWk04IDExQzcuNDQ3NzIgMTEgNyAxMS40NDc3IDcgMTJDNyAxMi41NTIzIDcuNDQ3NzIgMTMgOCAxM0M4LjU1MjI4IDEzIDkgMTIuNTUyMyA5IDEyQzkgMTEuNDQ3NyA4LjU1MjI4IDExIDggMTFaIiBmaWxsPSJ3aGl0ZSIvPjwvc3ZnPg==)注意

external_userid 需为最近 48 小时内有触发[用户进入会话事件](https://kf.weixin.qq.com/api/doc/path/95166#25220/用户进入会话事件)或向该客服账号发过消息的客户，否则在 `invalid_external_userid` 返回。

**返回结果**:

```json
{
    "errcode": 0,
    "errmsg": "ok",
    "customer_list": [
		{
			"external_userid": "wmxxxxxxxxxxxxxxxxxxxxxx",
			"nickname": "张三",
			"avatar": "http://xxxxx",
			"gender": 1,
			"unionid": "oxasdaosaosdasdasdasd",
			"enter_session_context": {
				"scene": "123",
				"scene_param": "abc",
				"wechat_channels": {
					"nickname": "进入会话的视频号名称",
					"scene": 1
				}
			}
		}
	],
	"invalid_external_userid": [
		"zhangsan"
	]
}
```

**参数说明**:

| 参数                                                         | 类型   | 说明                                                         |
| ------------------------------------------------------------ | ------ | ------------------------------------------------------------ |
| errcode                                                      | int    | 返回码                                                       |
| errmsg                                                       | string | 错误码描述                                                   |
| customer_list                                                | array  | 返回结果                                                     |
| customer_list.external_userid                                | string | 微信客户的external_userid                                    |
| customer_list.nickname                                       | string | 微信昵称                                                     |
| customer_list.avatar                                         | string | 微信头像。第三方不可获取                                     |
| customer_list.gender                                         | int    | 性别。第三方不可获取，统一返回`0`                            |
| customer_list.unionid                                        | string | unionid，需要绑定微信开发者账号才能获取到，查看[绑定方法](https://kf.weixin.qq.com/api/doc/path/95166#如何获取微信客户的unionid) |
| customer_list.enter_session_context                          | obj    | 48小时内最后一次进入会话的上下文信息。 请求的need_enter_session_context参数设置为1才返回 |
| customer_list.enter_session_context.scene                    | string | 进入会话的场景值，[获取客服账号链接](https://kf.weixin.qq.com/api/doc/path/95166#25214)开发者自定义的场景值 |
| customer_list.enter_session_context.scene_param              | string | 进入会话的自定义参数，[获取客服账号链接](https://kf.weixin.qq.com/api/doc/path/95166#25214)返回的url，开发者按规范拼接的scene_param参数 |
| customer_list.enter_session_context.wechat_channels          | obj    | 进入会话的视频号信息，从视频号进入会话才有值                 |
| customer_list.enter_session_context.wechat_channels.nickname | string | 视频号名称，视频号场景值为1、2、3时返回此项                  |
| customer_list.enter_session_context.wechat_channels.shop_nickname | string | 视频号小店名称，视频号场景值为4、5时返回此项                 |
| customer_list.enter_session_context.wechat_channels.scene    | uint32 | 视频号场景值。1：视频号主页，2：视频号直播间商品列表页，3：视频号商品橱窗页，4：视频号小店商品详情页，5：视频号小店订单页 |

 

### 如何获取微信客户的unionid

1. 在微信客服管理后台的「开发配置」处，点击“绑定”去到微信公众平台进行授权，支持绑定公众号和小程序（需要同时绑定微信开放平台）；绑定的公众号或小程序主体需与企业微信主体一致，暂且支持绑定一个
2. 绑定完成后，即可通过此接口获取微信客服所对应的微信Unionid
3. 第三方服务商此接口不返回Unionid，需自行通过其他已有的方式获取客户的Unionid，再通过[Unionid与external_userid关联接口](https://developer.work.weixin.qq.com/document/39850) ，将获取到的Unionid和external_userid实现关联识别。